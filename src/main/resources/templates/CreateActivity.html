<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.Thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../soms-style.css">
    <!-- <link rel="stylesheet" th:href="@{soms-style.css}"> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Register Activity</title>
</head>
<body>
    <header th:replace="fragments/header :: header"></header>

    <main>
      <div class="registerActivityContainer">
        <h1>Register New Activity</h1>
<!-- Upon submitting the below form, registerActivity() is being invoked which makes an AJAX request to register the activity in the database. -->
        <form action="/AddNewActivity/" method="get" id="myform" onsubmit="return registerActivity()">
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="activityName" placeholder="Activity Name" name="activityName">
                <label for="activityName">Activity Name</label>
            </div>
            <div class="row">
              <div class="col">
                <div class="form-floating mb-3">
                    <input type="date" class="form-control" id="activityDate" placeholder="dd/mm/yyyy" name="activityDate">
                    <label for="activityDate">Activity Date</label>
                </div>
              </div>
              <div class="col">
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="location" placeholder="Location" name="location">
                    <label for="location">Location</label>
                </div>
              </div>
            </div>
            <div class="form-floating mb-3">
              <textarea name="description" id="description" class="form-control" placeholder="Activity Description" style="height: 100px"></textarea>
              <label for="description">Description</label>
            </div>
            <div class="form-floating mb-3">
              <textarea name="keywords" id="keywords" class="form-control" placeholder="Keywords" style="height: 100px"></textarea>
              <label for="keywords">Keywords</label>
            </div>
            <button type="submit" class="btn btn-success" id="registerActivityButton">Register Activity</button>
        </form>
      </div>
    </main>

    <!-- Modal to display the confirmation popup message to the user. This modal is displayed after registering the activity in the database.  -->
    <div class="modal fade" id="savedMessage" visibility="hidden" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Registered New Activity!</h5>
            <!-- Removed the default modal close icon so that the user must click on the 'Close' button. -->
            <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
          </div>
          <div class="modal-body">
            Successfully registered the new Activity! Thanks!!
          </div>
          <div class="modal-footer">
            <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
            <!-- Added a custom button to close the modal. -->
            <a href="" class="btn btn-secondary" role="button">Close</a>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">

    /*  This is the AJAX function invoked when user clicks on 'Register Activity'
        This function makes a POST request call to the route /AddActivity to register the activity in the database. */
        function registerActivity() {
          var activityName = document.getElementById("activityName").value;
          var activityDate = document.getElementById("activityDate").value;
          var location = document.getElementById("location").value;
          var description = document.getElementById("description").value;
          var keywords = document.getElementById("keywords").value;
          var params = 'activityName=' + activityName + '&activityDate=' + activityDate + '&location=' + location + '&description=' + description + '&keywords=' + keywords;
          // console.log(params);
          var xhttp = new XMLHttpRequest();
          xhttp.open("POST", '/AddActivity', true); // true is asynchronous
          xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
          xhttp.onreadystatechange = function() {
            if (xhttp.readyState === 4 && xhttp.status === 200) {
              console.log(xhttp.responseText);
              // Initialize the modal to display the confirmation message.
              // Added the 'backdrop' value as 'static' so that the modal will not close when user clicks outside the modal.
              var myModal = new bootstrap.Modal(document.getElementById("savedMessage"), {
                backdrop: 'static', keyboard: false
              })
              myModal.show();   // Display the modal when the AJAX call is successful.
            } else {
              console.error(xhttp.statusText);
            }
          };
          xhttp.send(params);
          return false;
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>

    <footer th:replace="fragments/footer :: footer"></footer>
</body>
</html>
