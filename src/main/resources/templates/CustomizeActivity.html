<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.Thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../soms-style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Customize Activity</title>
</head>
<body>
  <header th:replace="fragments/header :: header"></header>
    <main>
      <!-- Below are the accordions displayed in the 'Customize Activity' page -->
      <div class="accordionsContainer">
        <div class="accordion accordion-flush" id="accordionExample">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                Selected Activity
                <h5 id="customizeTitle">Customize Inputs & Outputs</h5>
              </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne">
              <div class="accordion-body">
                <div class="row">
                    <div class="col" style="max-width:7%">
                        <label for="activityId">#</label>
                        <input type="text" class="form-control" id="activityId" name="activityId" th:value="${activityId}" readonly>
                    </div>
                    <div class="col" style="max-width:23%">
                        <label for="activityName">Activity Name</label>
                        <input type="text" class="form-control" id="activityName" name="activityName" th:value="${activityName}" readonly>
                    </div>
                    <div class="col" style="max-width:15%">
                        <label for="location">Location</label>
                        <input type="text" class="form-control" id="location" name="location" th:value="${location}" readonly>
                    </div>
                    <div class="col" style="max-width:15%">
                        <label for="activityDate">Activity Date</label>
                        <input type="text" class="form-control" id="activityDate" name="activityDate" th:value="${activityDate}" readonly>
                    </div>
                    <div class="col" style="max-width:40%">
                        <label for="description">Description</label>
                        <input type="text" class="form-control" id="description" name="description" th:value="${description}" readonly>
                    </div>
                </div>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingTwo">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                Customize Activity Metrics/Inputs
              </button>
            </h2>
            <div id="collapseTwo" class="accordion-collapse collapse show" aria-labelledby="headingTwo">
              <div class="accordion-body">
                <div class="row">
                  <div class="col-5">
                    <table class="table" id="activityInpTable">
                      <col style="width:10%">
                      <col style="width:90%">
                      <thead>
                        <tr>
                          <th scope="col"><input class="form-check-input" type="checkbox" name="selectAllInp" id="selectAllInp"></th>
                          <th scope="col">Selected Metrics/Inputs</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selectInpCheck" id="selectInpCheck"></td>
                          <td>Number of Volunteers</td>
                        </tr>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selectInpCheck" id="selectInpCheck"></td>
                          <td>Number of Hours</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="col-2">
                    <div class="d-grid gap-2 col-8 mx-auto" style="margin-top:40px">
                      <button class="btn btn-success" type="button" id="addInpButton"><i class="fa fa-angle-double-left"></i> Add</button>
                    </div>
                    <div class="d-grid gap-2 col-8 mx-auto" style="margin-top:5px">
                      <button class="btn btn-success" type="button" id="remInpButton"><i class="fa fa-angle-double-right"></i> Remove</button>
                    </div>
                  </div>
                  <div class="col-5">
                    <table class="table" id="tempInpTable">
                      <col style="width:10%">
                      <col style="width:90%">
                      <thead>
                        <tr>
                          <th scope="col"><input class="form-check-input" type="checkbox" name="selectAllTempInp" id="selectAllTempInp"></th>
                          <th scope="col">Pre-defined template inputs</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selecTempInpCheck" id="selecTempInpCheck"></td>
                          <td>Land area cleaned (in square feet)</td>
                        </tr>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selecTempInpCheck" id="selecTempInpCheck"></td>
                          <td>Distance covered/cleaned (in miles)</td>
                        </tr>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selecTempInpCheck" id="selecTempInpCheck"></td>
                          <td>Average no. of steps taken per volunteer</td>
                        </tr>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selecTempInpCheck" id="selecTempInpCheck"></td>
                          <td>No. of days spent on the activity</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="row">
                  <div class="col-5">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="customInp" placeholder="Custom Input" name="customInp" required>
                        <label for="customInp">Custom Input</label>
                    </div>
                  </div>
                  <div class="col-2">
                    <div class="form-floating mb-3">
                      <div class="d-grid gap-2 col-10 mx-auto">
                        <button class="btn btn-success" type="button" id="addCustInpButton"><i class="fa fa-plus"></i> Add Custom</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingThree">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                Customize Activity Outputs
              </button>
            </h2>
            <div id="collapseThree" class="accordion-collapse collapse show" aria-labelledby="headingThree">
              <div class="accordion-body">
                <div class="row">
                  <div class="col-5">
                    <table class="table" id="activityOutTable">
                      <col style="width:10%">
                      <col style="width:90%">
                      <thead>
                        <tr>
                          <th scope="col"><input class="form-check-input" type="checkbox" name="selectAllOut" id="selectAllOut"></th>
                          <th scope="col">Selected Outputs</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selectOutCheck" id="selectOutCheck" value="" onclick="selectOutput()"></td>
                          <td>Number of bags of rubbish collected</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="col-2">
                    <div class="d-grid gap-2 col-8 mx-auto" style="margin-top:40px">
                      <button class="btn btn-success" type="button" id="addOutButton"><i class="fa fa-angle-double-left"></i> Add</button>
                    </div>
                    <div class="d-grid gap-2 col-8 mx-auto" style="margin-top:5px">
                      <button class="btn btn-success" type="button" id="remOutButton"><i class="fa fa-angle-double-right"></i> Remove</button>
                    </div>
                  </div>
                  <div class="col-5">
                    <table class="table" id="tempOutTable">
                      <col style="width:10%">
                      <col style="width:90%">
                      <thead>
                        <tr>
                          <th scope="col"><input class="form-check-input" type="checkbox" name="selectAllTempOut" id="selectAllTempOut"></th>
                          <th scope="col">Pre-defined template outputs</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selectTempOutCheck" id="selectTempOutCheck"></td>
                          <td>No. of bags of recyclable material collected</td>
                        </tr>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selectTempOutCheck" id="selectTempOutCheck"></td>
                          <td>No. of bags of hazardous items collected</td>
                        </tr>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selectTempOutCheck" id="selectTempOutCheck"></td>
                          <td>Weight of plastic or non-degradable items (kg)</td>
                        </tr>
                        <tr>
                          <td><input class="form-check-input" type="checkbox" name="selectTempOutCheck" id="selectTempOutCheck"></td>
                          <td>River water (concentration of pollutants - µg/l)</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="row">
                  <div class="col-5">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="customOut" placeholder="Custom Output" name="customOut" required>
                        <label for="customOut">Custom Output</label>
                    </div>
                  </div>
                  <div class="col-2">
                    <div class="form-floating mb-3">
                      <div class="d-grid gap-2 col-10 mx-auto">
                        <button class="btn btn-success" type="button" id="addCustOutButton"><i class="fa fa-plus"></i> Add Custom</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button type="submit" class="btn btn-success" id="submitCustomize">Submit Customization</button>
      </div>
    </main>

    <!-- Modal to display the confirmation popup message to the user. This modal is displayed after saving the customized activity in the database.  -->
    <div class="modal fade" id="customizedMessage" visibility="hidden" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content animate">
          <div class="modal-header" id="common-modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Customized Activity!</h5>
            <!-- Removed the default modal close icon so that the user must click on the 'Close' button. -->
            <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
          </div>
          <div class="modal-body">
            Great! Successfully customized this activity! Thanks!!
          </div>
          <div class="modal-footer">
            <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
            <!-- Added a custom button to close the modal. -->
            <a href="/CreateActivity" class="btn btn-secondary" role="button">Close</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Display spinners to show that the page is loading. This is to simulate a real world scenario when the Ajax call takes a few seconds! -->
    <div class="overlay" id="loader">
      <div class="spinners">
        <div class="spinner-grow text-danger" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <div class="spinner-grow text-warning" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <div class="spinner-grow text-info" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>

    <script type="text/javascript">

    /*  jQuery functions to move the records from one table to another.
        These functions are invoked when user clicks the 'Add' and 'Remove' buttons to move the data between tables.
        On clicking 'Add/Remove', move the selected rows from one table to the other. If all rows are selected, move everything except the table header row. */

        $(document).ready(function() {
            $("#addInpButton").on("click", function() {
              // var selectedRows = $("#tempInpTable input:checked").parents("tr").not("thead tr").remove().clone().appendTo($("#activityInpTable tbody").add(selectedRows));
      // Commented above line and added jQuery fadeIn/fadeOut to display animation while adding/deleting rows in the two tables
                var selectedRows = $("#tempInpTable input:checked").parents("tr").not("thead tr").clone();
                $("#tempInpTable input:checked").parents("tr").not("thead tr").fadeOut("slow", function() {$(this).remove();});
                $("#activityInpTable").append(selectedRows);
                selectedRows.hide();
                selectedRows.fadeIn("slow");
                $(".form-check-input").prop("checked", false);  // de-select checkboxes after moving the rows
            });
        });
        $(document).ready(function() {
            $("#remInpButton").on("click", function() {
                // var selectedRows = $("#activityInpTable input:checked").parents("tr").not("thead tr").remove().clone().appendTo($("#tempInpTable tbody").add(selectedRows));
      // Commented above line and added jQuery fadeIn/fadeOut to display animation while adding/deleting rows in the two tables
                var selectedRows = $("#activityInpTable input:checked").parents("tr").not("thead tr").clone();
                $("#activityInpTable input:checked").parents("tr").not("thead tr").fadeOut("slow", function() {$(this).remove();});
                $("#tempInpTable").append(selectedRows);
                selectedRows.hide();
                selectedRows.fadeIn("slow");
                $(".form-check-input").prop("checked", false);  // de-select checkboxes after moving the rows
            });
        });
        $(document).ready(function() {
            $("#addOutButton").on("click", function() {
                // var selectedRows = $("#tempOutTable input:checked").parents("tr").not("thead tr").remove().clone().appendTo($("#activityOutTable tbody").add(selectedRows));
      // Commented above line and added jQuery fadeIn/fadeOut to display animation while adding/deleting rows in the two tables
                var selectedRows = $("#tempOutTable input:checked").parents("tr").not("thead tr").clone();
                $("#tempOutTable input:checked").parents("tr").not("thead tr").fadeOut("slow", function() {$(this).remove();});
                $("#activityOutTable").append(selectedRows);
                selectedRows.hide();
                selectedRows.fadeIn("slow");
                $(".form-check-input").prop("checked", false);  // de-select checkboxes after moving the rows
            });
        });
        $(document).ready(function() {
            $("#remOutButton").on("click", function() {
                // var selectedRows = $("#activityOutTable input:checked").parents("tr").not("thead tr").remove().clone().appendTo($("#tempOutTable tbody").add(selectedRows));
      // Commented above line and added jQuery fadeIn/fadeOut to display animation while adding/deleting rows in the two tables
                var selectedRows = $("#activityOutTable input:checked").parents("tr").not("thead tr").clone();
                $("#activityOutTable input:checked").parents("tr").not("thead tr").fadeOut("slow", function() {$(this).remove();});
                $("#tempOutTable").append(selectedRows);
                selectedRows.hide();
                selectedRows.fadeIn("slow");
                $(".form-check-input").prop("checked", false);  // de-select checkboxes after moving the rows
            });
        });

        // jQuery function to add custom inputs/outputs to the table
        $(document).ready(function() {
            $("#addCustInpButton").on("click", function() {
                var custInput = $("#customInp").val();  // Get the custom input text entered by the user
                $("#activityInpTable").append('<tr><td><input class="form-check-input" type="checkbox" name="selectInpCheck" id="selectInpCheck"></td><td>' + custInput + '</td></tr>');
                $("#customInp").val("");
            });
        });

        $(document).ready(function() {
            $("#addCustOutButton").on("click", function() {
                var custOutput = $("#customOut").val();   // Get the custom output text entered by the user
                $("#activityOutTable").append('<tr><td><input class="form-check-input" type="checkbox" name="selectOutCheck" id="selectOutCheck"></td><td>' + custOutput + '</td></tr>');
                $("#customOut").val("");
            });
        });

        // jQuery function to select/de-select all the records in a table when the 'Select All' checkbox is checked or unchecked
        $(function() {
            $("#activityInpTable #selectAllInp").click(function() {
                if(this.checked) {
                    $("#activityInpTable .form-check-input").prop("checked", true);   // select the checkbox
                } else {
                    $("#activityInpTable .form-check-input").prop("checked", false);  // de-select the checkbox
                }
            });
            $("#tempInpTable #selectAllTempInp").click(function() {
                if(this.checked) {
                    $("#tempInpTable .form-check-input").prop("checked", true);
                } else {
                    $("#tempInpTable .form-check-input").prop("checked", false);
                }
            });
            $("#activityOutTable #selectAllOut").click(function() {
                if(this.checked) {
                    $("#activityOutTable .form-check-input").prop("checked", true);
                } else {
                    $("#activityOutTable .form-check-input").prop("checked", false);
                }
            });
            $("#tempOutTable #selectAllTempOut").click(function() {
                if(this.checked) {
                    $("#tempOutTable .form-check-input").prop("checked", true);
                } else {
                    $("#tempOutTable .form-check-input").prop("checked", false);
                }
            });
        });

// jQuery function to make an Ajax HTTP POST request to save the customized activity.
        $(function() {
            $("#submitCustomize").click(function() {
                let activityId = $("#activityId").val();  // Get the activity id

            /* ALlowing customizations from the third row (excluding header) onwards in the inputs table.
              The first two are default metrics/inputs for all activities.
              Below are the jQuery functions to select the specific cell values from the table. */
                var custMetric1 = $("#activityInpTable tr:eq(3) td:eq(1)").text();  // Get the value from 4th row and 2nd column in the table
                var custMetric2 = $("#activityInpTable tr:eq(4) td:eq(1)").text();
                var custMetric3 = $("#activityInpTable tr:eq(5) td:eq(1)").text();
                var custMetric4 = $("#activityInpTable tr:eq(6) td:eq(1)").text();
                var custMetric5 = $("#activityInpTable tr:eq(7) td:eq(1)").text();
                var custMetric6 = $("#activityInpTable tr:eq(8) td:eq(1)").text();

            /* ALlowing customizations from the second row (excluding header) onwards in the outputs table.
              The first one is a default output for all activities.
              Below are the jQuery functions to select the specific cell values from the table. */
                var custOutput1 = $("#activityOutTable tr:eq(2) td:eq(1)").text();  // Get the value from 3rd row and 2nd column in the table
                var custOutput2 = $("#activityOutTable tr:eq(3) td:eq(1)").text();
                var custOutput3 = $("#activityOutTable tr:eq(4) td:eq(1)").text();
                var custOutput4 = $("#activityOutTable tr:eq(5) td:eq(1)").text();
                var custOutput5 = $("#activityOutTable tr:eq(6) td:eq(1)").text();
                var custOutput6 = $("#activityOutTable tr:eq(7) td:eq(1)").text();

                // Construct the key-value pairs for the request parameters
                var params = {'activityId' : activityId, 'serviceProvId' : 1,
                              'custMetric1' : custMetric1, 'custMetric2' : custMetric2, 'custMetric3' : custMetric3,
                              'custMetric4' : custMetric4, 'custMetric5' : custMetric5, 'custMetric6' : custMetric6,
                              'custOutput1' : custOutput1, 'custOutput2' : custOutput2, 'custOutput3' : custOutput3,
                              'custOutput4' : custOutput4, 'custOutput5' : custOutput5, 'custOutput6' : custOutput6};

                $("#loader").show();  // Display spinners to simulate a page loading scenario
                $.ajax({
                    type: 'POST',
                    url: 'http://localhost:8080/SubmitCustomizedActivity',
                    data: params,
                    dataType: "text",
                    success: function(response) {
        /* This is to simulate a real world scenario when the Ajax call takes a few seconds!
          Show the spinners just before the Ajax call. Delay the Ajax call by 3 seconds and then hide the spinners! */
                      setTimeout(function() {
                        $("#loader").hide();
                        // Display the confirmation modal if the call is successful
                        var myModal = new bootstrap.Modal(document.getElementById("customizedMessage"), {
                          backdrop: 'static', keyboard: false
                        });
                        myModal.show();
                      }, 3000);
                    }
                });
            });
        });


    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>

    <footer th:replace="fragments/footer :: footer"></footer>
</body>
</html>
